<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>X2 Drag Block Game</title>

<style>
body{
  margin:0;
  background:#14001f;
  font-family:Arial;
  color:white;
  text-align:center;
  overflow:hidden;
}

.top{
  padding:15px;
  font-size:22px;
  display:flex;
  justify-content:space-around;
}

#game{
  width:95%;
  max-width:500px;
  height:500px;
  margin:auto;
  display:flex;
  justify-content:space-between;
}

.column{
  width:18%;
  background:#222;
  border-radius:8px;
  display:flex;
  flex-direction:column-reverse;
  align-items:center;
  padding:5px;
}

.block{
  width:90%;
  height:60px;
  margin:5px 0;
  border-radius:8px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  font-size:20px;
  transition:0.2s;
}

.dropzone{
  width:100%;
  height:100%;
}

.bottom{
  margin-top:15px;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:20px;
}

.current, .next{
  width:70px;
  height:70px;
  border-radius:10px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:22px;
  font-weight:bold;
}

button{
  padding:10px 15px;
  border:none;
  border-radius:6px;
  background:#00aaff;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

.pop{
  animation:pop 0.2s ease;
}

@keyframes pop{
  50%{transform:scale(1.2);}
}
</style>
</head>

<body>

<div class="top">
  <div>Score: <span id="score">0</span></div>
  <div>Best: <span id="best">0</span></div>
</div>

<div id="game"></div>

<div class="bottom">
  <div class="current" id="current" draggable="true"></div>
  <div class="next" id="next"></div>
  <button onclick="restart()">Restart</button>
</div>

<script>
const game=document.getElementById("game");
let score=0;
let best=localStorage.getItem("best")||0;
document.getElementById("best").innerText=best;

let columns=[];
let maxHeight=10;

/* Create 5 columns */
for(let i=0;i<5;i++){
  let col=document.createElement("div");
  col.className="column";
  col.dataset.index=i;
  col.addEventListener("dragover",e=>e.preventDefault());
  col.addEventListener("drop",dropBlock);
  game.appendChild(col);
  columns.push(col);
}

function randomVal(){
  let vals=[2,4,8,16];
  return vals[Math.floor(Math.random()*vals.length)];
}

function color(val){
  let colors={
    2:"#3498db",
    4:"#2ecc71",
    8:"#f1c40f",
    16:"#e67e22",
    32:"#e74c3c",
    64:"#9b59b6",
    128:"#1abc9c",
    256:"#ff00aa",
    512:"#00ffff",
    1024:"#ffffff",
    2048:"#ff8800",
    4096:"#ff4444",
    8192:"#00ff99",
    16384:"#ffaa00"
  };
  return colors[val]||"#ffffff";
}

/* Current & Next */
let currentVal=randomVal();
let nextVal=randomVal();

function updateBottom(){
  let c=document.getElementById("current");
  let n=document.getElementById("next");

  c.innerText=currentVal;
  c.style.background=color(currentVal);

  n.innerText=nextVal;
  n.style.background=color(nextVal);
}

updateBottom();

/* Drag Start */
document.getElementById("current").addEventListener("dragstart",e=>{
  e.dataTransfer.setData("val",currentVal);
});

/* Drop Logic */
function dropBlock(e){
  let val=parseInt(e.dataTransfer.getData("val"));
  let col=e.currentTarget;

  if(col.children.length>=maxHeight){
    alert("Game Over!");
    return;
  }

  let block=document.createElement("div");
  block.className="block";
  block.innerText=val;
  block.dataset.val=val;
  block.style.background=color(val);

  col.appendChild(block);

  merge(col);

  currentVal=nextVal;
  nextVal=randomVal();
  updateBottom();
}

/* Merge */
function merge(col){
  let blocks=col.querySelectorAll(".block");

  for(let i=0;i<blocks.length-1;i++){
    let b1=blocks[i];
    let b2=blocks[i+1];

    if(b1.dataset.val==b2.dataset.val){
      let newVal=parseInt(b1.dataset.val)*2;

      b2.dataset.val=newVal;
      b2.innerText=newVal;
      b2.style.background=color(newVal);
      b2.classList.add("pop");

      score+=newVal;
      document.getElementById("score").innerText=score;

      if(score>best){
        best=score;
        localStorage.setItem("best",best);
        document.getElementById("best").innerText=best;
      }

      b1.remove();

      setTimeout(()=>b2.classList.remove("pop"),200);

      merge(col);
      break;
    }
  }
}

/* Restart */
function restart(){
  location.reload();
}
</script>

</body>
</html>
